/* Appnima v0.8.13 - 2013/8/13
   http://tapquo.com
   Copyright (c) 2013 Tapquo S.L. - Licensed GPLv3 */
!function(){!function(a){var b,c,d,e,f;c=function(){this._callbacks=[];return this};e=function(a){var b,d,e,f,g,h,i;b=a.length;d=0;h=new c;e=[];i=[];g=function(a){return function(c,f){d+=1;e[a]=c;i[a]=f;if(d===b){return h.done(e,i)}}};f=0;while(f<b){a[f]().then(g(f));f++}return h};d=function(a,b,e,f){var g;g=new c;if(a.length===0||f!=null&&b!=null){g.done(b,e)}else{a[0](b,e).then(function(b,c){a.splice(0,1);return d(a,b,c,f).then(function(a,b){return g.done(a,b)})})}return g};f=function(a,b,c){return d(a,b,c,true)};c.prototype.then=function(a,b){var c;c=function(){return a.apply(b,arguments)};if(this._isdone){return c(this.error,this.result)}else{return this._callbacks.push(c)}};c.prototype.done=function(a,b){var c,d;this._isdone=true;this.error=a;this.result=b;c=0;d=this._callbacks.length;while(c<d){this._callbacks[c](a,b);c++}return this._callbacks=[]};b={Promise:c,join:e,chain:d,shield:f};if(typeof define==="function"&&define.amd){return define(function(){return b})}else{return a.Hope=b}}(this)}.call(this);!function(){var a;window.Appnima=a={};a.version="0.1.0507";a.key=null;a.token=null;a.production=true;a.Dom=typeof $$!=="undefined"&&$$!==null?$$:$;a.onError=null}.call(this);!function(){Appnima.connect=function(a,b,c,d){var e,f,g,h=this;if(d==null){d=false}f={};if(d&&Appnima.key!=null){f={Authorization:"basic "+Appnima.key}}if(!d&&Appnima.key){f={Authorization:"bearer "+Appnima.token}}g=new Hope.Promise;try{this.Dom.ajax({url:b,type:a,headers:f,data:c,dataType:"json",contentType:"application/x-www-form-urlencoded",success:function(a){if(a){return g.done(null,a)}else{return g.done("Unknown error",null)}},error:function(a,b,c){var d,e;if(typeof a!=="string"){b=a}e=b.response!=null?b.response:b.responseText;d={code:b.status,type:b.statusText,message:JSON.parse(e).message};g.done(d,null);if(Appnima.onError!=null){return Appnima.onError.call(h,d)}}})}catch(i){e=i;g.done(e,null)}return g}}.call(this);!function(){Appnima.Instance=function(a){var b,c;b={DEV:{user:"http://localhost:1337/",messenger:"http://localhost:1337/messenger/",location:"http://localhost:1337/location/",socket:"http://192.168.1.184:1337/",push:"http://localhost:1337/push/"},PRO:{user:"http://api.appnima.com/",messenger:"http://api.appnima.com/messenger/",location:"http://api.appnima.com/location/",socket:"http://ec2-54-245-167-216.us-west-2.compute.amazonaws.com/",push:"http://api.appnima.com/push/"}};c=function(c){return b[a.production?"PRO":"DEV"][c]};return{get:c}}(Appnima)}.call(this);!function(){Appnima.Location=function(a){var b,c,d,e,f,g,h,i,j,k;h=function(b,c,d,e,f){var g;if(e==null){e=5e3}if(f==null){f=null}g={latitude:b,longitude:c};if(d!=null){g.precision=d}if(d==null){g.radius=e}return a.connect("GET",""+k()+"places",g)};g=function(b,c){var d;d={id:b};if(c!=null){d.reference=c}return a.connect("GET",""+k()+"place",d)};b=function(b,c,d,e,f,g,h,i,j,l){var m;m={name:b,address:c,locality:d,postal_code:e,country:f,latitude:g,longitude:h};if(i!=null){m.mail=i}if(j!=null){m.phone=j}if(l!=null){m.website=l}return a.connect("POST",""+k()+"place",m)};c=function(b){return a.connect("POST",""+k()+"checkin",{id:b})};d=function(b){return a.connect("GET",""+k()+"checkin",{user:b})};e=function(a,b,c){if(c==null){c=5e3}return j("friends",a,b,c)};f=function(a,b,c){if(c==null){c=5e3}return j("people",a,b,c)};i=function(b,c){var d;d={latitude:b!=null?b:void 0,longitude:c!=null?c:void 0};if(d.latitude!=null&&d.longitude!=null){return a.connect("POST",""+k()+"user",d)}else{return a.connect("GET",""+k()+"user")}};j=function(b,c,d,e){var f;if(e==null){e=5e3}f={latitude:c,longitude:d,radius:e};return a.connect("GET",""+k()+b,f)};k=function(){return a.Instance.get("location")};return{places:h,place:g,add:b,checkin:c,checkins:d,people:f,friends:e,user:i}}(Appnima)}.call(this);!function(){Appnima.Messenger=function(a){var b,c,d,e,f,g,h,i,j;d=function(b,c,d){var e;e={user:b,subject:c,message:d};return a.connect("POST",""+j()+"mail",e)};e=function(b,c,d){var e;e={user:b,message:c,subject:d};return a.connect("POST",""+j()+"message",e)};b=function(b,c){var d;d={user:b,message:c};return a.connect("POST",""+j()+"sms",d)};f=function(){return a.connect("GET",""+j()+"message/inbox",{})};g=function(){return a.connect("GET",""+j()+"message/outbox",{})};h=function(a){return i(a,"READ")};c=function(a){return i(a,"DELETED")};i=function(b,c){var d;d={message:b,state:c};return a.connect("PUT",""+j()+"message",d)};j=function(){return a.Instance.get("messenger")};return{mail:d,SMS:b,message:e,readMessage:h,deleteMessage:c,messageInbox:f,messageOutbox:g}}(Appnima)}.call(this);!function(){Appnima.Network=function(a){var b,c,d,e,f,g,h,i,j,k;f=function(b){var c;c=b?{user:b}:null;return a.connect("GET",""+k()+"network/stats",c)};e=function(b){var c;c=b?{user:b}:null;return a.connect("GET",""+k()+"network/following",c)};d=function(b){var c;c=b?{user:b}:null;return a.connect("GET",""+k()+"network/followers",c)};c=function(a){return j("POST","follow",a)};b=function(a){return j("GET","check",a)};h=function(a){return j("POST","unfollow",a)};g=function(b){return a.connect("GET",""+k()+"network/search",{query:b})};j=function(b,c,d){var e;e=new Hope.Promise;if(d){a.connect(b,""+k()+"network/"+c,{user:d}).then(function(a,b){return e.done(a,b)})}else{e.done({code:1,message:"Insuficient parameters",type:"Client"},null)}return e};i=function(a){return this};k=function(){return a.Instance.get("user")};return{info:f,following:e,followers:d,check:b,follow:c,unfollow:h,search:g}}(Appnima)}.call(this);!function(){Appnima.Push=function(a){var b,c,d;c=function(b,c,e){var f;f={user:b,alert:c,content:JSON.stringify(e)};return a.connect("POST",""+d()+"push",f)};b=function(){return this};d=function(){return a.Instance.get("push")};return{send:c,received:b}}(Appnima)}.call(this);!function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){for(var c in b){if(d.call(b,c))a[c]=b[c]}function e(){this.constructor=a}e.prototype=b.prototype;a.prototype=new e;a.__super__=b.prototype;return a};Appnima.Socket=function(){var a;function b(b){this.onMessage=c(this.onMessage,this);this.onError=c(this.onError,this);this.onConnect=c(this.onConnect,this);this.send=c(this.send,this);this.disallowUsers=c(this.disallowUsers,this);this.allowUsers=c(this.allowUsers,this);this.disconnect=c(this.disconnect,this);this.connect=c(this.connect,this);this.create=c(this.create,this);var d=this;this.socket=io.connect(a(),{"force new connection":true});if(b!=null){this.connect(b)}this.socket.on("connect",function(){return d.connected=true})}b.prototype.create=function(a,b,c,d,e){var f=this;if(c==null){c=true}if(d==null){d=""}if(e==null){e=[]}if(this.connected){return this.socket.emit("open",Appnima.token,a,d,b,c,e)}else{return this.socket.on("connect",function(){f.connected=true;return f.socket.emit("open",Appnima.token,a,d,b,c,e)})}};b.prototype.connect=function(a){var b=this;if(this.connected){return this.socket.emit("join",Appnima.token,a)}else{this.connected=true;return this.socket.on("connect",function(){return b.socket.emit("join",Appnima.token,a)})}};b.prototype.disconnect=function(){return this.socket.emit("leave")};b.prototype.allowUsers=function(a){if(a==null){a=[]}return this.socket.emit("allowUsers",a)};b.prototype.disallowUsers=function(a){if(a==null){a=[]}return this.socket.emit("disallowUsers",a)};b.prototype.send=function(a){return this.socket.emit("sendMessage",a)};b.prototype.broadcast=function(a){return this.socket.emit("sendBroadcast",a)};b.prototype.onConnect=function(a){return this.socket.on("onConnection",function(b){return a(b)})};b.prototype.onError=function(a){var b=this;return this.socket.on("onError",function(c){if(c.indexOf("[CONNECTION ERROR]")!==-1){b.disconnect()}return a(c)})};b.prototype.onMessage=function(a){return this.socket.on("onMessage",function(b){return a(b)})};b.prototype.api=function(b,c,d){return Appnima.connect(b,""+a()+c,d)};b.prototype.messages=function(a){return this};a=function(){return Appnima.Instance.get("socket")};return b}();Appnima.Socket.Group=function(b){e(c,b);function c(){a=c.__super__.constructor.apply(this,arguments);return a}c.prototype.create=function(a,b,d){if(b==null){b=[]}if(d==null){d=true}return c.__super__.create.call(this,null,"private",d,a,b)};c.prototype.list=function(){return this.api("GET","api/groups")};c.prototype.remove=function(a){return this.api("PUT","api/group",{id:a})};return c}(Appnima.Socket);Appnima.Socket.Chat=function(a){e(c,a);function c(){b=c.__super__.constructor.apply(this,arguments);return b}c.prototype.create=function(a,b){if(b==null){b=[]}return c.__super__.create.call(this,a,b,false)};return c}(Appnima.Socket.Group);Appnima.Socket.Emiter=function(a){e(b,a);function b(a){b.__super__.constructor.call(this,null);this.create(a,"public",false,a)}return b}(Appnima.Socket);Appnima.Socket.Listener=function(a){e(b,a);function b(a){b.__super__.constructor.apply(this,arguments)}return b}(Appnima.Socket);Appnima.Socket.Application=function(a){e(b,a);function b(){b.__super__.constructor.call(this,null);this.connect(null)}return b}(Appnima.Socket);Appnima.Socket.Inbox=function(a){e(b,a);function b(){b.__super__.constructor.call(this,null);this.create(null,"inbox",false)}return b}(Appnima.Socket);Appnima.Socket.User=function(a){e(b,a);function b(a){b.__super__.constructor.apply(this,arguments)}return b}(Appnima.Socket)}.call(this);!function(){Appnima.User=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;h=function(b,c,d){var e,f,g=this;f=new Hope.Promise;e={password:c,username:d!=null?d:b};if(b!=null){e.mail=b}Hope.chain([function(){return a.connect("POST",""+o()+"user/signup",e,l)},function(b,c){var d;d=n(c);e.grant_type="password";return a.connect("POST",""+o()+"oauth2/token",e,true)}]).then(function(a,b){return m(f,a,b)});return f};l=function(){var b,c,d;c=new Hope.Promise;d=n();b={refresh_token:d.refresh_token,grant_type:"refresh_token"};a.connect("POST",""+o()+"oauth2/token",b,true).then(function(a,b){return m(c,a,b)});return c};g=function(){var b;b=JSON.parse(localStorage.getItem(a.key));if(b){Appnima.token=b.access_token;a.connect("GET",""+o()+"user/info").then(function(a,b){return n(b)})}return b};d=function(b,c,d){var e,f;f=new Hope.Promise;e={password:c,username:d!=null?d:null};if(b!=null){e.mail=b}a.connect("POST",""+o()+"user/login",e,true).then(function(a,b){return m(f,a,b)});return f};e=function(b,c,d){var e;e=new Hope.Promise;setTimeout(function(){localStorage.removeItem(a.key);return e.done(null,{status:"ok"})},300);return e};c=function(b){if(!b){return a.connect("GET",""+o()+"user/info")}else{return a.connect("PUT",""+o()+"user/info",b)}};b=function(b){return a.connect("POST",""+o()+"user/avatar",{avatar:b},false)};f=function(b,c){var d;d={old_password:b,new_password:c};return a.connect("POST",""+o()+"user/password",d,false)};j=function(b,c,d,e){var f,g;f="GET";g={};if(b!=null){f="POST";g={os:b,token:d,type:c,version:e}}return a.connect(f,""+o()+"user/terminal",g)};i=function(b){return a.connect("POST",""+o()+"user/subscription",{mail:b},true)};k=function(b,c){var d;d={type:b,question:c};return a.connect("POST",""+o()+"user/ticket",d)};o=function(){return a.Instance.get("user")};m=function(a,b,c){if(!b){return a.done(null,n(c))}else{return a.done(b,null)}};n=function(b){var c,d;d=JSON.parse(localStorage.getItem(a.key))||{};if(b){for(c in b){d[c]=b[c]}localStorage.setItem(a.key,JSON.stringify(d));if(d.access_token!=null){Appnima.token=d.access_token}}return d};return{signup:h,token:l,login:d,logout:e,session:g,info:c,avatar:b,password:f,terminal:j,subscribe:i,ticket:k}}(Appnima)}.call(this);
